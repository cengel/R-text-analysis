<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Analyzing Texts | Text Analysis with R</title>
  <meta name="description" content="Workshop materials for Text Analysis in R" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Analyzing Texts | Text Analysis with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Workshop materials for Text Analysis in R" />
  <meta name="github-repo" content="cengel/R-text-analysis" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Analyzing Texts | Text Analysis with R" />
  
  <meta name="twitter:description" content="Workshop materials for Text Analysis in R" />
  

<meta name="author" content="Claudia Engel, Scott Bailey" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="textprep.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Text Analysis with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#references"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="textprep.html"><a href="textprep.html"><i class="fa fa-check"></i><b>1</b> Preparing Textual Data</a>
<ul>
<li class="chapter" data-level="1.1" data-path="textprep.html"><a href="textprep.html#reading-text-into-r"><i class="fa fa-check"></i><b>1.1</b> Reading text into R</a></li>
<li class="chapter" data-level="1.2" data-path="textprep.html"><a href="textprep.html#string-operations"><i class="fa fa-check"></i><b>1.2</b> String operations</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="textprep.html"><a href="textprep.html#counting-ocurrences"><i class="fa fa-check"></i><b>1.2.1</b> Counting ocurrences</a></li>
<li class="chapter" data-level="1.2.2" data-path="textprep.html"><a href="textprep.html#detecting-patterns"><i class="fa fa-check"></i><b>1.2.2</b> Detecting patterns</a></li>
<li class="chapter" data-level="1.2.3" data-path="textprep.html"><a href="textprep.html#extracting-words"><i class="fa fa-check"></i><b>1.2.3</b> Extracting words</a></li>
<li class="chapter" data-level="1.2.4" data-path="textprep.html"><a href="textprep.html#replacing-and-removing-characters"><i class="fa fa-check"></i><b>1.2.4</b> Replacing and removing characters</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="textprep.html"><a href="textprep.html#tokenize"><i class="fa fa-check"></i><b>1.3</b> Tokenize</a></li>
<li class="chapter" data-level="1.4" data-path="textprep.html"><a href="textprep.html#stopwords"><i class="fa fa-check"></i><b>1.4</b> Stopwords</a></li>
<li class="chapter" data-level="1.5" data-path="textprep.html"><a href="textprep.html#word-stemming"><i class="fa fa-check"></i><b>1.5</b> Word Stemming</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="textanalysis.html"><a href="textanalysis.html"><i class="fa fa-check"></i><b>2</b> Analyzing Texts</a>
<ul>
<li class="chapter" data-level="2.1" data-path="textanalysis.html"><a href="textanalysis.html#frequencies"><i class="fa fa-check"></i><b>2.1</b> Frequencies</a></li>
<li class="chapter" data-level="2.2" data-path="textanalysis.html"><a href="textanalysis.html#term-frequency"><i class="fa fa-check"></i><b>2.2</b> Term frequency</a></li>
<li class="chapter" data-level="2.3" data-path="textanalysis.html"><a href="textanalysis.html#tf-idf"><i class="fa fa-check"></i><b>2.3</b> Tf-idf</a></li>
<li class="chapter" data-level="2.4" data-path="textanalysis.html"><a href="textanalysis.html#n-grams"><i class="fa fa-check"></i><b>2.4</b> N-Grams</a></li>
<li class="chapter" data-level="2.5" data-path="textanalysis.html"><a href="textanalysis.html#co-occurrence"><i class="fa fa-check"></i><b>2.5</b> Co-occurrence</a></li>
<li class="chapter" data-level="2.6" data-path="textanalysis.html"><a href="textanalysis.html#document-term-matrix"><i class="fa fa-check"></i><b>2.6</b> Document-Term Matrix</a></li>
<li class="chapter" data-level="2.7" data-path="textanalysis.html"><a href="textanalysis.html#sentiment-analysis"><i class="fa fa-check"></i><b>2.7</b> Sentiment analysis</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Text Analysis with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="textanalysis" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Analyzing Texts<a href="textanalysis.html#textanalysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<blockquote>
<p>Learning Objectives</p>
<ul>
<li>perform frequency counts and generate plots</li>
<li>use the <code>widyr</code> package to calculate co-ocurrance</li>
<li>use <code>igraph</code> and <code>ggraph</code> to plot a co-ocurrance graph</li>
<li>import and export a Document-Term Matrix into <code>tidytext</code></li>
<li>use the <code>sentiments</code> dataset from <code>tidytext</code> to perform a sentiment analysis</li>
</ul>
</blockquote>
<hr />
<p>Now that we’ve read in our text and metadata, tokenized and cleaned it a little, let’s move on to some analysis.</p>
<p>First, we’ll make sure we have loaded the libraries we’ll need.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="textanalysis.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb39-2"><a href="textanalysis.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span></code></pre></div>
<p>Let’s remind ourselves of what our data looks like.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="textanalysis.html#cb40-1" aria-hidden="true" tabindex="-1"></a>tidy_sotu_words</span></code></pre></div>
<pre><code>#&gt; # A tibble: 778,161 × 7
#&gt;    president        year years_active party      sotu_type doc_id          word 
#&gt;    &lt;chr&gt;           &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;           &lt;chr&gt;
#&gt;  1 Abraham Lincoln  1861 1861-1865    Republican written   abraham-lincol… fell…
#&gt;  2 Abraham Lincoln  1861 1861-1865    Republican written   abraham-lincol… citi…
#&gt;  3 Abraham Lincoln  1861 1861-1865    Republican written   abraham-lincol… sena…
#&gt;  4 Abraham Lincoln  1861 1861-1865    Republican written   abraham-lincol… house
#&gt;  5 Abraham Lincoln  1861 1861-1865    Republican written   abraham-lincol… repr…
#&gt;  6 Abraham Lincoln  1861 1861-1865    Republican written   abraham-lincol… midst
#&gt;  7 Abraham Lincoln  1861 1861-1865    Republican written   abraham-lincol… unpr…
#&gt;  8 Abraham Lincoln  1861 1861-1865    Republican written   abraham-lincol… poli…
#&gt;  9 Abraham Lincoln  1861 1861-1865    Republican written   abraham-lincol… trou…
#&gt; 10 Abraham Lincoln  1861 1861-1865    Republican written   abraham-lincol… grat…
#&gt; # … with 778,151 more rows</code></pre>
<div id="frequencies" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Frequencies<a href="textanalysis.html#frequencies" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Since our unit of analysis at this point is a word, let’s count to determine which words occur most frequently in the corpus as a whole.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="textanalysis.html#cb42-1" aria-hidden="true" tabindex="-1"></a>tidy_sotu_words <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="textanalysis.html#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 29,558 × 2
#&gt;    word           n
#&gt;    &lt;chr&gt;      &lt;int&gt;
#&gt;  1 government  7573
#&gt;  2 congress    5759
#&gt;  3 united      5102
#&gt;  4 people      4219
#&gt;  5 country     3564
#&gt;  6 public      3413
#&gt;  7 time        3138
#&gt;  8 war         2961
#&gt;  9 american    2853
#&gt; 10 world       2581
#&gt; # … with 29,548 more rows</code></pre>
<p>We can pipe this into <code>ggplot</code> to make a graph of the words that occur more that 2000 times. We count the words and use <code>geom_col</code> to represent the n values.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="textanalysis.html#cb44-1" aria-hidden="true" tabindex="-1"></a>tidy_sotu_words <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="textanalysis.html#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word) <span class="sc">%&gt;%</span> </span>
<span id="cb44-3"><a href="textanalysis.html#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">2000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href="textanalysis.html#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">word =</span> <span class="fu">reorder</span>(word, n)) <span class="sc">%&gt;%</span>  <span class="co"># reorder values by frequency</span></span>
<span id="cb44-5"><a href="textanalysis.html#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(word, n)) <span class="sc">+</span></span>
<span id="cb44-6"><a href="textanalysis.html#cb44-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">&quot;gray&quot;</span>) <span class="sc">+</span></span>
<span id="cb44-7"><a href="textanalysis.html#cb44-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">coord_flip</span>()  <span class="co"># flip x and y coordinates so we can read the words better</span></span></code></pre></div>
<p><img src="R-text-analysis_files/figure-html/word-freq-plot-1.png" width="672" /></p>
<p>Now let’s look at a different question: In any given year, how often is the word ‘peace’ used and how often is the word ‘war’ used?</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="textanalysis.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># steps:</span></span>
<span id="cb45-2"><a href="textanalysis.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only the words &#39;war&#39; and &#39;peace&#39;.</span></span>
<span id="cb45-3"><a href="textanalysis.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># count ocurrences of each per year</span></span>
<span id="cb45-4"><a href="textanalysis.html#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="textanalysis.html#cb45-5" aria-hidden="true" tabindex="-1"></a>tidy_sotu_words <span class="sc">%&gt;%</span></span>
<span id="cb45-6"><a href="textanalysis.html#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(word <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;war&quot;</span>, <span class="st">&quot;peace&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-7"><a href="textanalysis.html#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year, word)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 435 × 3
#&gt;     year word      n
#&gt;    &lt;int&gt; &lt;chr&gt; &lt;int&gt;
#&gt;  1  1790 peace     3
#&gt;  2  1790 war       4
#&gt;  3  1791 peace     4
#&gt;  4  1791 war       1
#&gt;  5  1792 peace     5
#&gt;  6  1792 war       2
#&gt;  7  1793 peace     6
#&gt;  8  1793 war       4
#&gt;  9  1794 peace     3
#&gt; 10  1794 war       1
#&gt; # … with 425 more rows</code></pre>
<p>Now we can plot this as a bar chart that shows for each year the proportion of each of these two words out of the total of how often both words are used.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="textanalysis.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot n by year, and use position &#39;fill&#39; to show the proportion</span></span>
<span id="cb47-2"><a href="textanalysis.html#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="textanalysis.html#cb47-3" aria-hidden="true" tabindex="-1"></a>tidy_sotu_words <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="textanalysis.html#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(word <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;war&quot;</span>, <span class="st">&quot;peace&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-5"><a href="textanalysis.html#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year, word) <span class="sc">%&gt;%</span> </span>
<span id="cb47-6"><a href="textanalysis.html#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, n, <span class="at">fill =</span> word)) <span class="sc">+</span></span>
<span id="cb47-7"><a href="textanalysis.html#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">&quot;fill&quot;</span>)</span></code></pre></div>
<p><img src="R-text-analysis_files/figure-html/plot-word-years-1.png" width="672" /></p>
<p>As another example let us calculate the average number of words per speech for each president: How long was the average speech of each president and who are the most ‘wordy’ presidents?</p>
<p>First we summarize the words per president per speech:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="textanalysis.html#cb48-1" aria-hidden="true" tabindex="-1"></a>tidy_sotu_words <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="textanalysis.html#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(president, doc_id)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 236 × 3
#&gt;    president       doc_id                       n
#&gt;    &lt;chr&gt;           &lt;chr&gt;                    &lt;int&gt;
#&gt;  1 Abraham Lincoln abraham-lincoln-1861.txt  2578
#&gt;  2 Abraham Lincoln abraham-lincoln-1862.txt  3088
#&gt;  3 Abraham Lincoln abraham-lincoln-1863.txt  2398
#&gt;  4 Abraham Lincoln abraham-lincoln-1864.txt  2398
#&gt;  5 Andrew Jackson  andrew-jackson-1829.txt   3849
#&gt;  6 Andrew Jackson  andrew-jackson-1830.txt   5428
#&gt;  7 Andrew Jackson  andrew-jackson-1831.txt   2612
#&gt;  8 Andrew Jackson  andrew-jackson-1832.txt   2881
#&gt;  9 Andrew Jackson  andrew-jackson-1833.txt   2869
#&gt; 10 Andrew Jackson  andrew-jackson-1834.txt   4952
#&gt; # … with 226 more rows</code></pre>
<p>Then we use the output table and group it by president. That allows us to calculate the average number of words per speech.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="textanalysis.html#cb50-1" aria-hidden="true" tabindex="-1"></a>tidy_sotu_words <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="textanalysis.html#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(president, doc_id)  <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="textanalysis.html#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(president) <span class="sc">%&gt;%</span> </span>
<span id="cb50-4"><a href="textanalysis.html#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_words =</span> <span class="fu">mean</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-5"><a href="textanalysis.html#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_words))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 41 × 2
#&gt;    president           avg_words
#&gt;    &lt;chr&gt;                   &lt;dbl&gt;
#&gt;  1 William Howard Taft     9126.
#&gt;  2 William McKinley        7797 
#&gt;  3 Jimmy Carter            7673.
#&gt;  4 Theodore Roosevelt      7356 
#&gt;  5 James K. Polk           6920.
#&gt;  6 Grover Cleveland        5736.
#&gt;  7 James Buchanan          5409 
#&gt;  8 Benjamin Harrison       5308.
#&gt;  9 Rutherford B. Hayes     4411 
#&gt; 10 Martin Van Buren        4286.
#&gt; # … with 31 more rows</code></pre>
</div>
<div id="term-frequency" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Term frequency<a href="textanalysis.html#term-frequency" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Often a raw count of a word is less important than understanding how often that word appears <em>relative to the total number</em> of words in a text. This ratio is called the <strong>term frequency</strong>. We can use <code>dplyr</code> to calculate it like this:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="textanalysis.html#cb52-1" aria-hidden="true" tabindex="-1"></a>tidy_sotu_words <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="textanalysis.html#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(doc_id, word, <span class="at">sort =</span> T)  <span class="sc">%&gt;%</span>  <span class="co"># count occurrence of word and sort descending</span></span>
<span id="cb52-3"><a href="textanalysis.html#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(doc_id) <span class="sc">%&gt;%</span> </span>
<span id="cb52-4"><a href="textanalysis.html#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_tot =</span> <span class="fu">sum</span>(n),              <span class="co"># count total number of words per doc</span></span>
<span id="cb52-5"><a href="textanalysis.html#cb52-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">term_freq =</span> n<span class="sc">/</span>n_tot)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 352,846 × 5
#&gt; # Groups:   doc_id [236]
#&gt;    doc_id                       word               n n_tot term_freq
#&gt;    &lt;chr&gt;                        &lt;chr&gt;          &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;
#&gt;  1 harry-s-truman-1946.txt      dollars          207 12614   0.0164 
#&gt;  2 jimmy-carter-1980b.txt       congress         204 16128   0.0126 
#&gt;  3 harry-s-truman-1946.txt      war              201 12614   0.0159 
#&gt;  4 william-howard-taft-1910.txt government       164 11178   0.0147 
#&gt;  5 james-k-polk-1846.txt        mexico           158  7023   0.0225 
#&gt;  6 richard-m-nixon-1974b.txt    federal          141  9996   0.0141 
#&gt;  7 harry-s-truman-1946.txt      million          138 12614   0.0109 
#&gt;  8 harry-s-truman-1946.txt      fiscal           129 12614   0.0102 
#&gt;  9 jimmy-carter-1981.txt        administration   129 16595   0.00777
#&gt; 10 william-howard-taft-1912.txt government       129 10215   0.0126 
#&gt; # … with 352,836 more rows</code></pre>
<p>Let’s plot the distribution of the term frequency for the speeches:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="textanalysis.html#cb54-1" aria-hidden="true" tabindex="-1"></a>tidy_sotu_words <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="textanalysis.html#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(doc_id, word)  <span class="sc">%&gt;%</span>  <span class="co"># count n for each word</span></span>
<span id="cb54-3"><a href="textanalysis.html#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(doc_id) <span class="sc">%&gt;%</span> </span>
<span id="cb54-4"><a href="textanalysis.html#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_tot =</span> <span class="fu">sum</span>(n), <span class="co"># count total number of words per doc</span></span>
<span id="cb54-5"><a href="textanalysis.html#cb54-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">term_freq =</span> n<span class="sc">/</span>n_tot) <span class="sc">%&gt;%</span> </span>
<span id="cb54-6"><a href="textanalysis.html#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(term_freq)) <span class="sc">+</span></span>
<span id="cb54-7"><a href="textanalysis.html#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>() </span></code></pre></div>
<p><img src="R-text-analysis_files/figure-html/termfreq-plot-1.png" width="672" /></p>
<p>This distribution makes sense. Many words are used relatively rarely in a text. Only a few have a high term frequency.</p>
<p>Assuming that terms with high relative frequency are an indicator of significance we can find the term with the highest term frequency for each president:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="textanalysis.html#cb55-1" aria-hidden="true" tabindex="-1"></a>tidy_sotu_words <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="textanalysis.html#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(president, word)  <span class="sc">%&gt;%</span>  <span class="co"># count n for each word</span></span>
<span id="cb55-3"><a href="textanalysis.html#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(president) <span class="sc">%&gt;%</span> </span>
<span id="cb55-4"><a href="textanalysis.html#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_tot =</span> <span class="fu">sum</span>(n), <span class="co"># count total number of words per doc</span></span>
<span id="cb55-5"><a href="textanalysis.html#cb55-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">term_freq =</span> n<span class="sc">/</span>n_tot) <span class="sc">%&gt;%</span> </span>
<span id="cb55-6"><a href="textanalysis.html#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(term_freq)) <span class="sc">%&gt;%</span> <span class="co"># sort by term frequency</span></span>
<span id="cb55-7"><a href="textanalysis.html#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="co"># take the top for each president</span></span>
<span id="cb55-8"><a href="textanalysis.html#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>) <span class="co"># print all rows</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 43 × 5
#&gt; # Groups:   president [41]
#&gt;    president             word           n n_tot term_freq
#&gt;    &lt;chr&gt;                 &lt;chr&gt;      &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;
#&gt;  1 John Adams            united        49  2768   0.0177 
#&gt;  2 John Tyler            government   209 12596   0.0166 
#&gt;  3 Martin Van Buren      government   256 17145   0.0149 
#&gt;  4 William J. Clinton    people       336 22713   0.0148 
#&gt;  5 Franklin D. Roosevelt war          283 19311   0.0147 
#&gt;  6 William McKinley      government   452 31188   0.0145 
#&gt;  7 Andrew Jackson        government   436 31031   0.0141 
#&gt;  8 Andrew Johnson        government   207 14968   0.0138 
#&gt;  9 George Washington     united        86  6226   0.0138 
#&gt; 10 Calvin Coolidge       government   274 20518   0.0134 
#&gt; 11 James K. Polk         mexico       360 27679   0.0130 
#&gt; 12 James Buchanan        government   279 21636   0.0129 
#&gt; 13 Zachary Taylor        congress      38  2948   0.0129 
#&gt; 14 Ulysses S. Grant      united       359 27933   0.0129 
#&gt; 15 William Howard Taft   government   461 36506   0.0126 
#&gt; 16 Grover Cleveland      government   574 45889   0.0125 
#&gt; 17 Franklin Pierce       united       200 16240   0.0123 
#&gt; 18 George Bush           world         82  6706   0.0122 
#&gt; 19 James Monroe          united       184 15157   0.0121 
#&gt; 20 George W. Bush        america      209 17265   0.0121 
#&gt; 21 Millard Fillmore      government   135 11986   0.0113 
#&gt; 22 John Quincy Adams     congress     131 11788   0.0111 
#&gt; 23 Harry S Truman        war          308 27819   0.0111 
#&gt; 24 Gerald R. Ford        federal       65  5879   0.0111 
#&gt; 25 Herbert Hoover        government   121 10947   0.0111 
#&gt; 26 Rutherford B. Hayes   congress     194 17644   0.0110 
#&gt; 27 Chester A. Arthur     government   185 16961   0.0109 
#&gt; 28 Lyndon B. Johnson     congress     115 11207   0.0103 
#&gt; 29 James Madison         war           85  8327   0.0102 
#&gt; 30 Barack Obama          america      204 20529   0.00994
#&gt; 31 Benjamin Harrison     government   209 21230   0.00984
#&gt; 32 Richard M. Nixon      federal      232 23701   0.00979
#&gt; 33 Jimmy Carter          congress     518 53710   0.00964
#&gt; 34 John F. Kennedy       world         68  7302   0.00931
#&gt; 35 Theodore Roosevelt    government   528 58848   0.00897
#&gt; 36 Ronald Reagan         government   133 15005   0.00886
#&gt; 37 Ronald Reagan         people       133 15005   0.00886
#&gt; 38 Woodrow Wilson        government   105 11982   0.00876
#&gt; 39 Warren G. Harding     public        39  4583   0.00851
#&gt; 40 Dwight D. Eisenhower  world        204 24410   0.00836
#&gt; 41 Thomas Jefferson      country       58  7418   0.00782
#&gt; 42 Abraham Lincoln       congress      81 10462   0.00774
#&gt; 43 Abraham Lincoln       united        81 10462   0.00774</code></pre>
<blockquote>
<blockquote>
<blockquote>
<p>CHALLENGE: Pick one president. For each of his speeches, which is the term with highest term frequency? Create a table as output. (Hint: <code>top_n</code>might be useful)</p>
</blockquote>
</blockquote>
</blockquote>
</div>
<div id="tf-idf" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Tf-idf<a href="textanalysis.html#tf-idf" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>So far we’ve been looking at term frequency per document. What if we want to know about words that seem more important based on the contents of the <em>entire</em> corpus?</p>
<p>For this, we can use <strong>term-frequency according to inverse document frequency</strong>, also callled <strong>tf-idf</strong>. Tf-idf measures how important a word is within a corpus by scaling term frequency per document according to the inverse of the term’s document frequency (number of documents within the corpus in which the term appears divided by the number of documents).</p>
<p>The tf-idf value will be:</p>
<ul>
<li>lower for words that appear frequently in many documents of the corpus, and lowest when the word occurs in virtually all documents.</li>
<li>higher for words that appear frequently in just a few documents of the corpus, this lending high discriminatory power to those few documents.</li>
</ul>
<p>The intuition here is that if a term appears frequently in a document, we think that it is important but if that word appears in too many other documents, it is not that unique and thus perhaps not that important.</p>
<p>The <code>tidytext</code> package includes a function <code>bind_tf_idf</code>. It takes a table that contains one-row-per-term-per-document, the name of the column that contains the words (terms), the name of the column which contains the doc-id, and the name of the column that contains the document-term counts.</p>
<p>So below we aggregate our tibble with the word tokens to create the one-row-per-term-per-document table and then pipe it into the <code>bind_tf_idf</code> function.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="textanalysis.html#cb57-1" aria-hidden="true" tabindex="-1"></a>tidy_sotu_words <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="textanalysis.html#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(doc_id, word, <span class="at">sort =</span> <span class="cn">TRUE</span>)  <span class="sc">%&gt;%</span>  <span class="co"># aggregate to count n for each word</span></span>
<span id="cb57-3"><a href="textanalysis.html#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_tf_idf</span>(word, doc_id, n) </span></code></pre></div>
<pre><code>#&gt; # A tibble: 352,846 × 6
#&gt;    doc_id                       word               n      tf     idf    tf_idf
#&gt;    &lt;chr&gt;                        &lt;chr&gt;          &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
#&gt;  1 harry-s-truman-1946.txt      dollars          207 0.0164  0.612   0.0100   
#&gt;  2 jimmy-carter-1980b.txt       congress         204 0.0126  0.00425 0.0000537
#&gt;  3 harry-s-truman-1946.txt      war              201 0.0159  0.0345  0.000550 
#&gt;  4 william-howard-taft-1910.txt government       164 0.0147  0.00425 0.0000623
#&gt;  5 james-k-polk-1846.txt        mexico           158 0.0225  0.810   0.0182   
#&gt;  6 richard-m-nixon-1974b.txt    federal          141 0.0141  0.293   0.00414  
#&gt;  7 harry-s-truman-1946.txt      million          138 0.0109  0.728   0.00796  
#&gt;  8 harry-s-truman-1946.txt      fiscal           129 0.0102  0.494   0.00505  
#&gt;  9 jimmy-carter-1981.txt        administration   129 0.00777 0.282   0.00219  
#&gt; 10 william-howard-taft-1912.txt government       129 0.0126  0.00425 0.0000536
#&gt; # … with 352,836 more rows</code></pre>
<p>Our function added three columns to the aggregated table which contain term frequency (<code>tf</code>), inverse document frequency (<code>idf</code>) and Tf-idf (<code>tf_idf</code>).</p>
<p>Let’s look at some of the words in the corpus that have the highest tf-idf scores, which means words that are particularly distinctive for their documents.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="textanalysis.html#cb59-1" aria-hidden="true" tabindex="-1"></a>tidy_sotu_words <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="textanalysis.html#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(doc_id, word, <span class="at">sort =</span> <span class="cn">TRUE</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="textanalysis.html#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_tf_idf</span>(word, doc_id, n) <span class="sc">%&gt;%</span> </span>
<span id="cb59-4"><a href="textanalysis.html#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(tf_idf))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 352,846 × 6
#&gt;    doc_id                        word          n      tf   idf tf_idf
#&gt;    &lt;chr&gt;                         &lt;chr&gt;     &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
#&gt;  1 lyndon-b-johnson-1966.txt     vietnam      32 0.0152   2.42 0.0367
#&gt;  2 jimmy-carter-1980a.txt        soviet       31 0.0218   1.47 0.0321
#&gt;  3 george-w-bush-2003.txt        hussein      19 0.00811  3.85 0.0313
#&gt;  4 george-w-bush-2003.txt        saddam       19 0.00811  3.67 0.0298
#&gt;  5 franklin-d-roosevelt-1943.txt 1942         13 0.00758  3.85 0.0292
#&gt;  6 dwight-d-eisenhower-1961.txt  1953         23 0.00747  3.85 0.0288
#&gt;  7 john-adams-1800.txt           gentlemen     8 0.0153   1.80 0.0275
#&gt;  8 benjamin-harrison-1892.txt    1892         40 0.00741  3.52 0.0261
#&gt;  9 franklin-d-roosevelt-1942.txt hitler        7 0.00527  4.77 0.0251
#&gt; 10 herbert-hoover-1930.txt       1928         14 0.00711  3.52 0.0250
#&gt; # … with 352,836 more rows</code></pre>
<p>To understand the occurrence of the years as being particularly distinctive we might need to look more closely at the speeches themselves, and determine whether the years are significant or whether they need to be removed from the text either permanently in the clean up or temporarily using <code>filter()</code>.</p>
<blockquote>
<blockquote>
<blockquote>
<p>CHALLENGE: Pick the same president you chose above. For each of his speeches, which is the term with highest tf-idf? Create a table as output. (Hint: Remember to group by doc_id before you use top_n)</p>
</blockquote>
</blockquote>
</blockquote>
</div>
<div id="n-grams" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> N-Grams<a href="textanalysis.html#n-grams" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We mentioned n-grams in the intro, but let’s revisit them here and take a look at the most common bigrams in the speeches. Remember we can use the <code>unnest_token()</code> function on our texts and explicitly tell it to generate bigrams:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="textanalysis.html#cb61-1" aria-hidden="true" tabindex="-1"></a>sotu_whole <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="textanalysis.html#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(bigram, text, <span class="at">token =</span> <span class="st">&quot;ngrams&quot;</span>, <span class="at">n =</span> <span class="dv">2</span>) <span class="co"># create bigram</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 1,964,976 × 7
#&gt;    president        year years_active party      sotu_type doc_id         bigram
#&gt;    &lt;chr&gt;           &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;          &lt;chr&gt; 
#&gt;  1 Abraham Lincoln  1861 1861-1865    Republican written   abraham-linco… fello…
#&gt;  2 Abraham Lincoln  1861 1861-1865    Republican written   abraham-linco… citiz…
#&gt;  3 Abraham Lincoln  1861 1861-1865    Republican written   abraham-linco… of the
#&gt;  4 Abraham Lincoln  1861 1861-1865    Republican written   abraham-linco… the s…
#&gt;  5 Abraham Lincoln  1861 1861-1865    Republican written   abraham-linco… senat…
#&gt;  6 Abraham Lincoln  1861 1861-1865    Republican written   abraham-linco… and h…
#&gt;  7 Abraham Lincoln  1861 1861-1865    Republican written   abraham-linco… house…
#&gt;  8 Abraham Lincoln  1861 1861-1865    Republican written   abraham-linco… of re…
#&gt;  9 Abraham Lincoln  1861 1861-1865    Republican written   abraham-linco… repre…
#&gt; 10 Abraham Lincoln  1861 1861-1865    Republican written   abraham-linco… in the
#&gt; # … with 1,964,966 more rows</code></pre>
<p>Let’s see the most common bigrams:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="textanalysis.html#cb63-1" aria-hidden="true" tabindex="-1"></a>sotu_whole <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="textanalysis.html#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(bigram, text, <span class="at">token =</span> <span class="st">&quot;ngrams&quot;</span>, <span class="at">n =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-3"><a href="textanalysis.html#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(bigram, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="co"># count occurrences and sort descending</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 469,092 × 2
#&gt;    bigram            n
#&gt;    &lt;chr&gt;         &lt;int&gt;
#&gt;  1 of the        33610
#&gt;  2 in the        12499
#&gt;  3 to the        11643
#&gt;  4 for the        6892
#&gt;  5 and the        6224
#&gt;  6 by the         5606
#&gt;  7 of our         5172
#&gt;  8 the united     4767
#&gt;  9 united states  4760
#&gt; 10 it is          4756
#&gt; # … with 469,082 more rows</code></pre>
<p>Ok, so we again need to remove the stopwords. First let us separate the two words into two columns “word1” and “word2” with <code>separate</code> from the <code>tidyr</code> package:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="textanalysis.html#cb65-1" aria-hidden="true" tabindex="-1"></a>sotu_whole <span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="textanalysis.html#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(bigram, text, <span class="at">token =</span> <span class="st">&quot;ngrams&quot;</span>, <span class="at">n =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb65-3"><a href="textanalysis.html#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(bigram, <span class="fu">c</span>(<span class="st">&quot;word1&quot;</span>, <span class="st">&quot;word2&quot;</span>), <span class="at">sep =</span> <span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1,964,976 × 8
#&gt;    president        year years_active party      sotu_type doc_id    word1 word2
#&gt;    &lt;chr&gt;           &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;
#&gt;  1 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… fell… citi…
#&gt;  2 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… citi… of   
#&gt;  3 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… of    the  
#&gt;  4 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… the   sena…
#&gt;  5 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… sena… and  
#&gt;  6 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… and   house
#&gt;  7 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… house of   
#&gt;  8 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… of    repr…
#&gt;  9 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… repr… in   
#&gt; 10 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… in    the  
#&gt; # … with 1,964,966 more rows</code></pre>
<p>Now we use dplyr’s <code>filter()</code> function to select only the words in each column that are not in the stopwords.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="textanalysis.html#cb67-1" aria-hidden="true" tabindex="-1"></a>sotu_whole <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="textanalysis.html#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(bigram, text, <span class="at">token =</span> <span class="st">&quot;ngrams&quot;</span>, <span class="at">n =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb67-3"><a href="textanalysis.html#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(bigram, <span class="fu">c</span>(<span class="st">&quot;word1&quot;</span>, <span class="st">&quot;word2&quot;</span>), <span class="at">sep =</span> <span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># separate into cols</span></span>
<span id="cb67-4"><a href="textanalysis.html#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>word1 <span class="sc">%in%</span> stop_words<span class="sc">$</span>word, <span class="co"># remove stopwords</span></span>
<span id="cb67-5"><a href="textanalysis.html#cb67-5" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>word2 <span class="sc">%in%</span> stop_words<span class="sc">$</span>word)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 215,992 × 8
#&gt;    president        year years_active party      sotu_type doc_id    word1 word2
#&gt;    &lt;chr&gt;           &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;
#&gt;  1 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… fell… citi…
#&gt;  2 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… unpr… poli…
#&gt;  3 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… poli… trou…
#&gt;  4 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… abun… harv…
#&gt;  5 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… pecu… exig…
#&gt;  6 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… fore… nati…
#&gt;  7 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… prof… soli…
#&gt;  8 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… soli… chie…
#&gt;  9 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… dome… affa…
#&gt; 10 Abraham Lincoln  1861 1861-1865    Republican written   abraham-… disl… port…
#&gt; # … with 215,982 more rows</code></pre>
<p>Lastly, we re-unite the two word columns into back into our bigrams and save it into a new table <code>sotu_bigrams</code>.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="textanalysis.html#cb69-1" aria-hidden="true" tabindex="-1"></a>sotu_bigrams <span class="ot">&lt;-</span> sotu_whole <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="textanalysis.html#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(bigram, text, <span class="at">token =</span> <span class="st">&quot;ngrams&quot;</span>, <span class="at">n =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb69-3"><a href="textanalysis.html#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(bigram, <span class="fu">c</span>(<span class="st">&quot;word1&quot;</span>, <span class="st">&quot;word2&quot;</span>), <span class="at">sep =</span> <span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># separate into cols</span></span>
<span id="cb69-4"><a href="textanalysis.html#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>word1 <span class="sc">%in%</span> stop_words<span class="sc">$</span>word, <span class="co"># remove stopwords</span></span>
<span id="cb69-5"><a href="textanalysis.html#cb69-5" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>word2 <span class="sc">%in%</span> stop_words<span class="sc">$</span>word) <span class="sc">%&gt;%</span> </span>
<span id="cb69-6"><a href="textanalysis.html#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(bigram, word1, word2, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>)  <span class="co"># combine columns</span></span>
<span id="cb69-7"><a href="textanalysis.html#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="textanalysis.html#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="textanalysis.html#cb69-9" aria-hidden="true" tabindex="-1"></a>sotu_bigrams <span class="sc">%&gt;%</span> </span>
<span id="cb69-10"><a href="textanalysis.html#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(bigram, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 129,622 × 2
#&gt;    bigram                 n
#&gt;    &lt;chr&gt;              &lt;int&gt;
#&gt;  1 federal government   479
#&gt;  2 american people      428
#&gt;  3 june 30              325
#&gt;  4 fellow citizens      296
#&gt;  5 public debt          283
#&gt;  6 public lands         256
#&gt;  7 health care          240
#&gt;  8 social security      232
#&gt;  9 post office          202
#&gt; 10 annual message       200
#&gt; # … with 129,612 more rows</code></pre>
<p>A bigram can also be treated as a term in a document in the same way that we treated individual words. That means we can look at tf-idf values in the same way. For example, we can find out the most distinct bigrams that the presidents uttered in all their respective speeches taken together.</p>
<p>We count per president and bigram and then bind the tf-idf value with the <code>bind_tf_idf</code> function. In order to get the top bigram for each president we then group by president, and sort and retrieve the highest value for each.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="textanalysis.html#cb71-1" aria-hidden="true" tabindex="-1"></a>sotu_bigrams <span class="sc">%&gt;%</span></span>
<span id="cb71-2"><a href="textanalysis.html#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(president, bigram) <span class="sc">%&gt;%</span></span>
<span id="cb71-3"><a href="textanalysis.html#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_tf_idf</span>(bigram, president, n) <span class="sc">%&gt;%</span></span>
<span id="cb71-4"><a href="textanalysis.html#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(president) <span class="sc">%&gt;%</span>  </span>
<span id="cb71-5"><a href="textanalysis.html#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(tf_idf)) <span class="sc">%&gt;%</span> </span>
<span id="cb71-6"><a href="textanalysis.html#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 44 × 6
#&gt; # Groups:   president [41]
#&gt;    president          bigram              n      tf   idf tf_idf
#&gt;    &lt;chr&gt;              &lt;chr&gt;           &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
#&gt;  1 George W. Bush     al qaida           35 0.00628 3.02  0.0190
#&gt;  2 John Adams         john adams          3 0.00510 3.71  0.0189
#&gt;  3 William J. Clinton 21st century       59 0.00830 1.77  0.0147
#&gt;  4 Thomas Jefferson   gun boats           7 0.00462 3.02  0.0140
#&gt;  5 Thomas Jefferson   port towns          7 0.00462 3.02  0.0140
#&gt;  6 Thomas Jefferson   sea port            7 0.00462 3.02  0.0140
#&gt;  7 Zachary Taylor     german empire       5 0.00789 1.63  0.0129
#&gt;  8 Lyndon B. Johnson  south vietnam      13 0.00424 3.02  0.0128
#&gt;  9 James Madison      james madison       8 0.00412 3.02  0.0124
#&gt; 10 Harry S Truman     million dollars   119 0.0129  0.941 0.0121
#&gt; # … with 34 more rows</code></pre>
<blockquote>
<blockquote>
<blockquote>
<p>CHALLENGE: Again, pick the same president you chose above. For each of his speeches, which is the bigram with highest tf-idf? Create a table as output.</p>
</blockquote>
</blockquote>
</blockquote>
</div>
<div id="co-occurrence" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Co-occurrence<a href="textanalysis.html#co-occurrence" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Co-occurrences give us a sense of words that appear in the same text, but not necessarily next to each other.</p>
<p>For this section we will make use of the <code>widyr</code> package. The function which helps us do this is the <code>pairwise_count()</code> function. It lets us count common pairs of words co-appearing within the same speech.</p>
<p>Behind the scenes, this function first turns our table into a wide matrix. In our case that matrix will be made up of the individual words and the cell values will be the counts of in how many speeches they co-occur, like this:</p>
<pre><code>#&gt;      we thus have
#&gt; we   NA    4    5
#&gt; thus  4   NA    2
#&gt; have  5    2   NA</code></pre>
<p>It then will turn the matrix back into a tidy form, where each row contains the word pairs and the count of their co-occurrence. Since we don’t care about the order of the words, we will not count the upper triangle of the wide matrix, which leaves us with:</p>
<pre><code>#&gt;             
#&gt;    we thus 4
#&gt;    we have 5
#&gt;  thus have 2</code></pre>
<p>Since processing the entire corpus would take too long here, we will only look at the last 100 words of each speech: which words occur most commonly together at the end of the speeches?</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="textanalysis.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(widyr)</span>
<span id="cb75-2"><a href="textanalysis.html#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="textanalysis.html#cb75-3" aria-hidden="true" tabindex="-1"></a>sotu_word_pairs <span class="ot">&lt;-</span> sotu_whole <span class="sc">%&gt;%</span> </span>
<span id="cb75-4"><a href="textanalysis.html#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">speech_end =</span> <span class="fu">word</span>(text, <span class="sc">-</span><span class="dv">100</span>, <span class="at">end =</span> <span class="sc">-</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span>  <span class="co"># extract last 100 words</span></span>
<span id="cb75-5"><a href="textanalysis.html#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, speech_end) <span class="sc">%&gt;%</span>   <span class="co"># tokenize</span></span>
<span id="cb75-6"><a href="textanalysis.html#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>word <span class="sc">%in%</span> stop_words<span class="sc">$</span>word) <span class="sc">%&gt;%</span>  <span class="co"># remove stopwords</span></span>
<span id="cb75-7"><a href="textanalysis.html#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pairwise_count</span>(word, doc_id, <span class="at">sort =</span> <span class="cn">TRUE</span>, <span class="at">upper =</span> <span class="cn">FALSE</span>) <span class="co"># don&#39;t include upper triangle of matrix</span></span>
<span id="cb75-8"><a href="textanalysis.html#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="textanalysis.html#cb75-9" aria-hidden="true" tabindex="-1"></a>sotu_word_pairs</span></code></pre></div>
<pre><code>#&gt; # A tibble: 125,576 × 3
#&gt;    item1      item2       n
#&gt;    &lt;chr&gt;      &lt;chr&gt;   &lt;dbl&gt;
#&gt;  1 god        bless      37
#&gt;  2 god        america    35
#&gt;  3 bless      america    30
#&gt;  4 people     country    26
#&gt;  5 world      god        22
#&gt;  6 god        people     22
#&gt;  7 government people     21
#&gt;  8 congress   people     21
#&gt;  9 public     country    21
#&gt; 10 god        nation     21
#&gt; # … with 125,566 more rows</code></pre>
<p>To visualize the co-occurrence network of words that occur together at the end of 10 or more speeches, we use the <code>igraph</code> package to convert our table into a network graph and the <code>ggraph</code> package which adds functionality to ggplot to make it easier to plot a network.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="textanalysis.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb77-2"><a href="textanalysis.html#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggraph)</span>
<span id="cb77-3"><a href="textanalysis.html#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="textanalysis.html#cb77-4" aria-hidden="true" tabindex="-1"></a>sotu_word_pairs <span class="sc">%&gt;%</span> </span>
<span id="cb77-5"><a href="textanalysis.html#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span>  <span class="co"># only word pairs that occur 10 or more times</span></span>
<span id="cb77-6"><a href="textanalysis.html#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">graph_from_data_frame</span>() <span class="sc">%&gt;%</span> <span class="co">#convert to graph</span></span>
<span id="cb77-7"><a href="textanalysis.html#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>(<span class="at">layout =</span> <span class="st">&quot;fr&quot;</span>) <span class="sc">+</span> <span class="co"># place nodes according to the force-directed algorithm of Fruchterman and Reingold</span></span>
<span id="cb77-8"><a href="textanalysis.html#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="fu">aes</span>(<span class="at">edge_alpha =</span> n, <span class="at">edge_width =</span> n), <span class="at">edge_colour =</span> <span class="st">&quot;tomato&quot;</span>) <span class="sc">+</span></span>
<span id="cb77-9"><a href="textanalysis.html#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb77-10"><a href="textanalysis.html#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">repel =</span> <span class="cn">TRUE</span>, </span>
<span id="cb77-11"><a href="textanalysis.html#cb77-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">point.padding =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;lines&quot;</span>)) <span class="sc">+</span></span>
<span id="cb77-12"><a href="textanalysis.html#cb77-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="R-text-analysis_files/figure-html/plot-network-1.png" width="672" /></p>
<p>There are alternative approaches for this as well. See for example the <code>findAssocs</code> function in the <code>tm</code> package.</p>
</div>
<div id="document-term-matrix" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Document-Term Matrix<a href="textanalysis.html#document-term-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A <a href="https://en.wikipedia.org/wiki/Document-term_matrix">document-term matrix (DTM)</a> is a format which is frequently used in text analysis. It is a matrix where we can see the counts of each term per document. In a DTM each row represents a document, each column represents a term, and the cell values are the counts of the occurrences of the term for the particular document.</p>
<p><code>tidytext</code> provides functionality to convert to and from DTMs, if for example, your analysis requires specific functions from a different R package which only works with DTM object types.</p>
<p>The <code>cast_dtm</code> function can be used to create a DTM object from a tidy table.</p>
<p>Let’s assume that for some reason we want to use the <code>findAssoc()</code> function from the <code>tm</code> package.</p>
<p>First we use dplyr to create a table with the document name, the term, and the count.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="textanalysis.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make a table with document, term, count</span></span>
<span id="cb78-2"><a href="textanalysis.html#cb78-2" aria-hidden="true" tabindex="-1"></a>tidy_sotu_words <span class="sc">%&gt;%</span> </span>
<span id="cb78-3"><a href="textanalysis.html#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(doc_id, word) </span></code></pre></div>
<pre><code>#&gt; # A tibble: 352,846 × 3
#&gt;    doc_id                   word               n
#&gt;    &lt;chr&gt;                    &lt;chr&gt;          &lt;int&gt;
#&gt;  1 abraham-lincoln-1861.txt 1,470,018          1
#&gt;  2 abraham-lincoln-1861.txt 1,500              1
#&gt;  3 abraham-lincoln-1861.txt 100,000            1
#&gt;  4 abraham-lincoln-1861.txt 102,532,509.27     1
#&gt;  5 abraham-lincoln-1861.txt 12,528,000         1
#&gt;  6 abraham-lincoln-1861.txt 13,606,759.11      1
#&gt;  7 abraham-lincoln-1861.txt 1830               1
#&gt;  8 abraham-lincoln-1861.txt 1859               1
#&gt;  9 abraham-lincoln-1861.txt 1860               2
#&gt; 10 abraham-lincoln-1861.txt 1861               6
#&gt; # … with 352,836 more rows</code></pre>
<p>Now we cast it as a DTM.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="textanalysis.html#cb80-1" aria-hidden="true" tabindex="-1"></a>sotu_dtm <span class="ot">&lt;-</span> tidy_sotu_words <span class="sc">%&gt;%</span> </span>
<span id="cb80-2"><a href="textanalysis.html#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(doc_id, word) <span class="sc">%&gt;%</span> </span>
<span id="cb80-3"><a href="textanalysis.html#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cast_dtm</span>(doc_id, word, n) </span>
<span id="cb80-4"><a href="textanalysis.html#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="textanalysis.html#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(sotu_dtm)</span></code></pre></div>
<pre><code>#&gt; [1] &quot;DocumentTermMatrix&quot;    &quot;simple_triplet_matrix&quot;</code></pre>
<p>Finally, let’s use it in the <code>tm</code> package:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="textanalysis.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tm)</span>
<span id="cb82-2"><a href="textanalysis.html#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="textanalysis.html#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="co"># look at the terms with tm function</span></span>
<span id="cb82-4"><a href="textanalysis.html#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="fu">Terms</span>(sotu_dtm) <span class="sc">%&gt;%</span> <span class="fu">tail</span>()</span></code></pre></div>
<pre><code>#&gt; [1] &quot;queretaro&quot;    &quot;refreshments&quot; &quot;schleswig&quot;    &quot;sedulous&quot;     &quot;subagents&quot;   
#&gt; [6] &quot;transcript&quot;</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="textanalysis.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># most frequent terms</span></span>
<span id="cb84-2"><a href="textanalysis.html#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">findFreqTerms</span>(sotu_dtm, <span class="at">lowfreq =</span> <span class="dv">5000</span>)</span></code></pre></div>
<pre><code>#&gt; [1] &quot;congress&quot;   &quot;government&quot; &quot;united&quot;</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="textanalysis.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find terms associated with &quot;citizen&quot;</span></span>
<span id="cb86-2"><a href="textanalysis.html#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">findAssocs</span>(sotu_dtm, <span class="st">&quot;citizen&quot;</span>, <span class="at">corlimit =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>#&gt; $citizen
#&gt;        laws citizenship  protection   contained    entitled  government 
#&gt;        0.62        0.59        0.56        0.55        0.53        0.53 
#&gt;    citizens  postmaster     careful    question      report       suits 
#&gt;        0.52        0.52        0.51        0.51        0.51        0.51</code></pre>
<p>Conversely, <code>tidytext</code> implements the <code>tidy</code> function (originally from the <code>broom</code> package) to import DocumentTermMatrix objects. Note that it only takes the cells from the DTM that are not 0, so there will be no rows with 0 counts.</p>
</div>
<div id="sentiment-analysis" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Sentiment analysis<a href="textanalysis.html#sentiment-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>tidytext</code> comes with a dataset <code>sentiments</code> which contains several sentiment lexicons, where each word is attributed a certain sentiment, like this:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="textanalysis.html#cb88-1" aria-hidden="true" tabindex="-1"></a>sentiments</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6,786 × 2
#&gt;    word        sentiment
#&gt;    &lt;chr&gt;       &lt;chr&gt;    
#&gt;  1 2-faces     negative 
#&gt;  2 abnormal    negative 
#&gt;  3 abolish     negative 
#&gt;  4 abominable  negative 
#&gt;  5 abominably  negative 
#&gt;  6 abominate   negative 
#&gt;  7 abomination negative 
#&gt;  8 abort       negative 
#&gt;  9 aborted     negative 
#&gt; 10 aborts      negative 
#&gt; # … with 6,776 more rows</code></pre>
<p>Here we will take a look at how the sentiment of the speeches change over time. We will use the lexicon from <a href="https://www.cs.uic.edu/~liub/FBS/sentiment-analysis.html">Bing Liu and collaborators</a>, which assigns positive/negative labels for each word:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="textanalysis.html#cb90-1" aria-hidden="true" tabindex="-1"></a>bing_lex <span class="ot">&lt;-</span> <span class="fu">get_sentiments</span>(<span class="st">&quot;bing&quot;</span>)</span>
<span id="cb90-2"><a href="textanalysis.html#cb90-2" aria-hidden="true" tabindex="-1"></a>bing_lex</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6,786 × 2
#&gt;    word        sentiment
#&gt;    &lt;chr&gt;       &lt;chr&gt;    
#&gt;  1 2-faces     negative 
#&gt;  2 abnormal    negative 
#&gt;  3 abolish     negative 
#&gt;  4 abominable  negative 
#&gt;  5 abominably  negative 
#&gt;  6 abominate   negative 
#&gt;  7 abomination negative 
#&gt;  8 abort       negative 
#&gt;  9 aborted     negative 
#&gt; 10 aborts      negative 
#&gt; # … with 6,776 more rows</code></pre>
<p>We can use these sentiments attached to each word and join them to the words of our speeches. We will use <code>inner_join</code> from <code>dplyr</code>. It will take all rows with words from <code>tidy_sotu_words</code> that match words in <code>bing_lex</code>, eliminating rows where the word cannot be found in the lexicon. Since our columns to join on have the same name (<code>word</code>) we don’t need to explicitly name it.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="textanalysis.html#cb92-1" aria-hidden="true" tabindex="-1"></a>sotu_sentiments <span class="ot">&lt;-</span> tidy_sotu_words <span class="sc">%&gt;%</span> </span>
<span id="cb92-2"><a href="textanalysis.html#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(bing_lex)  <span class="co"># join to add semtinemt column</span></span>
<span id="cb92-3"><a href="textanalysis.html#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="textanalysis.html#cb92-4" aria-hidden="true" tabindex="-1"></a>sotu_sentiments</span></code></pre></div>
<pre><code>#&gt; # A tibble: 105,206 × 8
#&gt;    president        year years_active party     sotu_type doc_id word  sentiment
#&gt;    &lt;chr&gt;           &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;    
#&gt;  1 Abraham Lincoln  1861 1861-1865    Republic… written   abrah… trou… negative 
#&gt;  2 Abraham Lincoln  1861 1861-1865    Republic… written   abrah… grat… positive 
#&gt;  3 Abraham Lincoln  1861 1861-1865    Republic… written   abrah… unus… negative 
#&gt;  4 Abraham Lincoln  1861 1861-1865    Republic… written   abrah… abun… positive 
#&gt;  5 Abraham Lincoln  1861 1861-1865    Republic… written   abrah… pecu… negative 
#&gt;  6 Abraham Lincoln  1861 1861-1865    Republic… written   abrah… prof… positive 
#&gt;  7 Abraham Lincoln  1861 1861-1865    Republic… written   abrah… soli… negative 
#&gt;  8 Abraham Lincoln  1861 1861-1865    Republic… written   abrah… disl… negative 
#&gt;  9 Abraham Lincoln  1861 1861-1865    Republic… written   abrah… dest… negative 
#&gt; 10 Abraham Lincoln  1861 1861-1865    Republic… written   abrah… disr… negative 
#&gt; # … with 105,196 more rows</code></pre>
<p>Finally we can visualize the proportion of positive sentiment (out of the total of positive and negative) in US State of the Union Addresses over time like this:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="textanalysis.html#cb94-1" aria-hidden="true" tabindex="-1"></a>sotu_sentiments <span class="sc">%&gt;%</span> </span>
<span id="cb94-2"><a href="textanalysis.html#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year, sentiment) <span class="sc">%&gt;%</span> <span class="co"># count by year and sentiment</span></span>
<span id="cb94-3"><a href="textanalysis.html#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;sentiment&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;n&quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># create column for positive</span></span>
<span id="cb94-4"><a href="textanalysis.html#cb94-4" aria-hidden="true" tabindex="-1"></a>                                                               <span class="co"># and negative sentiment</span></span>
<span id="cb94-5"><a href="textanalysis.html#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">positive_ratio =</span> positive<span class="sc">/</span>(negative <span class="sc">+</span> positive)) <span class="sc">%&gt;%</span> <span class="co"># calculate positive ratio</span></span>
<span id="cb94-6"><a href="textanalysis.html#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb94-7"><a href="textanalysis.html#cb94-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, positive_ratio)) <span class="sc">+</span></span>
<span id="cb94-8"><a href="textanalysis.html#cb94-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color=</span><span class="st">&quot;gray&quot;</span>) <span class="sc">+</span></span>
<span id="cb94-9"><a href="textanalysis.html#cb94-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">span =</span> <span class="fl">0.3</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="co"># smooth for easier viewing</span></span>
<span id="cb94-10"><a href="textanalysis.html#cb94-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> .<span class="dv">5</span>, <span class="at">linetype=</span><span class="st">&quot;dotted&quot;</span>, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co"># .5 as reference</span></span>
<span id="cb94-11"><a href="textanalysis.html#cb94-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1790</span>, <span class="dv">2016</span>, <span class="at">by =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb94-12"><a href="textanalysis.html#cb94-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="R-text-analysis_files/figure-html/sentiment-plot-1.png" width="576" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="textprep.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/cengel/R-text-analysis/edit/master/02-data-analysis.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["R-text-analysis.pdf", "R-text-analysis.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
